---
sidebar_position: 14
---

# Reset Tunnel


مدت ها بود که می خواستم رفتار فایروال رو برسی کنم وقتی که پکت در لایه های پایین تر تغییر پیدا کنه 

نود های کار با پکت های لایه ۳ بالاخره روی واتروال پیاده سازی شد و الان که دارم مینویسم ؛ این نود ها فقط روی لینوکس کار میکنه و ویندوزش هنوز کامل نشده

تغییر پکت های روی لایه های ۳ و ۴ به ما امکان اینو میده که ۱۰ ها روش تونل جدید درست کنیم ؛ روش هایی که هرکودم شکل خودشون برای ارسال دیتا رو پیاده میکنن
و دیگه محدود به قوانینی که سیستم عامل قرار داده نیستن ؛ مثلا دیگه میشه به جای tcp / udp اومد و دیتا رو بر روی پروتکل هایی مثل icmp / appletalk / NetBios رد کرد 

و همچنین میشه همه این پروتکل هارو به صورت بی قاعده تغییر داد و به حداکثر flexibility در اجرای پروتکل دست یافت

لیست پروتکل های معمولا لایه ۴ در این لینک هستن

https://en.wikipedia.org/wiki/Transport_layer

و لیست پروتکل های لایه ۳ در این لینک

https://en.wikipedia.org/wiki/Network_layer

که ما همه این هارو در اختیار خواهیم داشت و آروم آروم سراغشون خواهیم رفتار

---

ریست تانل اولین روشی هست که با دستکاری توی لایه های زیری شبکه ایجاد میکنیم ؛ تمام ایده این روش اینه که پروتکل tcp عادی رد و بدل میشه منتهی با یک تغییر؛ 

در پروتکل tcp فلگ های مختلفی داریم که لیستش اینجا هست


![TcpSegment](../../../static/img/tcp.png)




ما با هر تغییری توی این ساختار می توانیم دیتا رو از استاندارد خارج کنیم ؛ اینطوری دیگه شخص میانی توانایی باز خوانی پکت ها و به اصطلاح reassembly را نخواهد داشت

در روش reset tunnel تغییری که اینجا شکل گرفته این هست که ؛ در تمام پکت های tcp فلگ reset ست میشه 

اینجوری پکت ها همه از نوع reset حساب میشن که کاربرد این فلگ برای این هست که کانکشن ها بسته بشه

ولی خوب ما وقتی پکت رو دریافت میکنیم ؛ اگه از ایپی سرور تونل ما بود ؛ بیت رو دستی خاموش میکنیم و پکت اصلاح شده رو تحویل سیستم عامل میدیم تا اتصال درست برقرار بشه


همچنین این اتفاق توی دیتا برگشتی هم میفته تا کاملا تمام پکت ها به این شکل دستکاری شده باشن؛ دیتای ارسال از سیستم عامل دریافت میشه و پکت تغییر میکنه

که در اینجا یعنی بیت ریست ست میشه ؛ سپس پکت به اصطلاح inject میشه به شبکه


این شاید ساده ترین تونلیه که میشه زد و در آینده node هایی میارم که بیت هارو با هم جا به جا کنیم ؛ مثلا جای بیت fin با init عوض بشه

و کلی حالت های دیگه که فقط میشه روی Tcp زد و سایر پرتوکل های لایه ۳و ۴ هم داریم که خیلی حالت میشه






